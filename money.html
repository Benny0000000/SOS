<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mfumo wa Uangalizi wa Fedha</title>
    <style>
        * { 
            box-sizing: 
            border-box; margin: 0; 
            padding: 0; font-family: 'Arial', sans-serif; 
        }

        body { 
            background-color: #f0f2f5; 
            color: #333; 
            line-height: 1.6; 
            padding: 20px; 
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
        }

        header { 
            background: linear-gradient(135deg, #2c5aa0, #1e3a8a); 
            color: white; padding: 25px; 
            text-align: center; border-radius: 10px; 
            margin-bottom: 25px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
        }

        h1 { 
            font-size: 2.2rem; 
            margin-bottom: 8px; 
        }

        .subtitle { 
            font-size: 1.1rem; 
            opacity: 0.9; 
        }

        .dashboard { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
            margin-bottom: 25px; 
        }

        .card { 
            background: white; 
            border-radius: 10px; 
            padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        }

        .card h2 { color: #2c3e50; margin-bottom: 15px; font-size: 1.3rem; border-bottom: 2px solid #f0f0f0; padding-bottom: 8px; }
        .balance-card { background: linear-gradient(135deg, #3498db, #2ecc71); color: white; }
        .balance-card h2 { color: white; border-bottom: 2px solid rgba(255,255,255,0.3); }
        .balance-amount { font-size: 2.2rem; font-weight: bold; text-align: center; margin: 15px 0; }
        .income-expense { display: flex; justify-content: space-around; text-align: center; }
        .income, .expense { padding: 8px; }
        .income h3, .expense h3 { font-size: 0.9rem; margin-bottom: 5px; }
        .income-amount { color: #2ecc71; font-size: 1.3rem; font-weight: bold; }
        .expense-amount { color: #e74c3c; font-size: 1.3rem; font-weight: bold; }
        .form-section { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
        form { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 1rem; }
        button { background: #3498db; color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: background 0.3s; width: 100%; margin-top: 10px; }
        button:hover { background: #2980b9; }
        .btn-income { background: #2ecc71; }
        .btn-income:hover { background: #27ae60; }
        .btn-expense { background: #e74c3c; }
        .btn-expense:hover { background: #c0392b; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f8f9fa; font-weight: 600; color: #2c3e50; }
        .income-row { border-left: 4px solid #2ecc71; }
        .expense-row { border-left: 4px solid #e74c3c; }
        .delete-btn { background: #e74c3c; color: white; border: none; padding: 6px 12px; border-radius: 3px; cursor: pointer; font-size: 0.9rem; }
        .delete-btn:hover { background: #c0392b; }
        .message { padding: 10px; margin: 10px 0; border-radius: 5px; text-align: center; font-weight: bold; display: none; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

        @media (max-width: 768px) {
            .form-section { grid-template-columns: 1fr; }
            .dashboard { grid-template-columns: 1fr; }
            h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Money Manager</h1>
            <p class="subtitle">Mapato ,matumizi,faida,hasara na kiasi kilichobaki</p>
        </header>
        
        <div id="message" class="message"></div>
        
        <div class="dashboard">
            <div class="card balance-card">
                <h2>Salio Lako</h2>
                <div class="balance-amount" id="balance">TSh 0</div>
                <div class="income-expense">
                    <div class="income">
                        <h3>Mapato</h3>
                        <div class="income-amount" id="total-income">TSh 0</div>
                    </div>
                    <div class="expense">
                        <h3>Matumizi</h3>
                        <div class="expense-amount" id="total-expense">TSh 0</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>Uchambuzi wa Matumizi</h2>
                <div id="expense-analysis">
                    <p>Hakuna data ya kutosha kwa uchambuzi bado.</p>
                </div>
            </div>
        </div>
        
        <div class="form-section">
            <form id="income-form">
                <h2>Ingiza kiasi cha Mapato yako</h2>
                <div class="form-group">
                    <label for="income-amount">Kiasi (TSh)</label>
                    <input type="number" id="income-amount" required min="1">
                </div>
                <div class="form-group">
                    <label for="income-source">Chanzo cha mapato yako</label>
                    <input type="text" id="income-source" required placeholder="Ingiza chanzo cha mapato yako">
                </div>
                <div class="form-group">
                    <label for="income-date">Tarehe ulio ongeza hela</label>
                    <input type="date" id="income-date" required>
                </div>
                <button type="submit" class="btn-income">Ongeza Mapato yako</button>
            </form>
            
            <form id="expense-form">
                <h2>Andika kiasi cha Matumizi yako</h2>
                <div class="form-group">
                    <label for="expense-amount">Kiasi (TSh)</label>
                    <input type="number" id="expense-amount" required min="1">
                </div>
                <div class="form-group">
                    <label for="expense-category">Aina ya Matumizi</label>
                    <select id="expense-category" required>
                        <option value="">Chagua aina ya matumizi uliyoyafanya</option>
                        <option value="chakula">Chakula</option>
                        <option value="malipo">Malipo</option>
                        <option value="usafiri">Usafiri</option>
                        <option value="matibabu">Matibabu</option>
                        <option value="mazingira">Ada</option>
                        <option value="burudani">Burudani</option>
                        <option value="nyingine">Nyingine</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="expense-description">Maelezo</label>
                    <input type="text" id="expense-description" required placeholder="Andika maelezo ya matumizi ya hela yako">
                </div>
                <div class="form-group">
                    <label for="expense-date">Tarehe</label>
                    <input type="date" id="expense-date" required>
                </div>
                <button type="submit" class="btn-expense">Andika Matumizi yako</button>
            </form>
        </div>
        
        <div class="card">
            <h2>Historia ya Fedha yako jinsi ilivyotumika</h2>
            <table id="transaction-table">
                <thead>
                    <tr>
                        <th>Tarehe</th>
                        <th>Maelezo</th>
                        <th>Aina</th>
                        <th>Kiasi (TSh)</th>
                        <th>Clear</th>
                    </tr>
                </thead>
                <tbody id="transaction-list"></tbody>
            </table>
        </div>
    </div>

    <script>
        
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        const balanceElement = document.getElementById('balance');
        const totalIncomeElement = document.getElementById('total-income');
        const totalExpenseElement = document.getElementById('total-expense');
        const transactionList = document.getElementById('transaction-list');
        const incomeForm = document.getElementById('income-form');
        const expenseForm = document.getElementById('expense-form');
        const expenseAnalysis = document.getElementById('expense-analysis');
        const messageElement = document.getElementById('message');

        function init() {
            updateUI();
            updateExpenseAnalysis();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('income-date').value = today;
            document.getElementById('expense-date').value = today;
            showMessage("Karibu kwenye mfumo wako wa fedha.", "success");
        }

        function showMessage(text, type) {
            messageElement.textContent = text;
            messageElement.className = `message ${type}`;
            messageElement.style.display = 'block';
            setTimeout(() => { messageElement.style.display = 'none'; }, 5000);
        }

        function updateUI() {
            updateBalance();
            updateTransactionList();
        }

        function updateBalance() {
            const amounts = transactions.map(t => t.type === 'income' ? t.amount : -t.amount);
            const total = amounts.reduce((acc, item) => acc + item, 0);
            const income = transactions.filter(t => t.type === 'income').reduce((acc, t) => acc + t.amount, 0);
            const expense = transactions.filter(t => t.type === 'expense').reduce((acc, t) => acc + t.amount, 0);
            balanceElement.textContent = `TSh ${formatCurrency(total)}`;
            totalIncomeElement.textContent = `TSh ${formatCurrency(income)}`;
            totalExpenseElement.textContent = `TSh ${formatCurrency(expense)}`;
            balanceElement.style.color = total < 0 ? '#ffdddd' : 'white';
        }

        function updateTransactionList() {
            transactionList.innerHTML = '';
            if (transactions.length === 0) {
                transactionList.innerHTML = `<tr><td colspan="5" style="text-align:center;">Hakuna shughuli zilizoingizwa bado.</td></tr>`;
                return;
            }
            const sortedTransactions = [...transactions].sort((a,b)=> new Date(b.date)-new Date(a.date));
            sortedTransactions.forEach(t=>{
                const row = document.createElement('tr');
                row.className = t.type==='income'?'income-row':'expense-row';
                const formattedDate = new Date(t.date).toLocaleDateString('sw-TZ');
                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${t.description}</td>
                    <td>${t.category||'-'}</td>
                    <td style="color:${t.type==='income'?'#2ecc71':'#e74c3c'}; font-weight:bold;">
                        ${t.type==='income'?'+':'-'} TSh ${formatCurrency(t.amount)}
                    </td>
                    <td><button class="delete-btn" data-id="${t.id}">Futa</button></td>
                `;
                transactionList.appendChild(row);
            });
            document.querySelectorAll('.delete-btn').forEach(b=>{
                b.addEventListener('click', function(){ deleteTransaction(this.getAttribute('data-id')); });
            });
        }

        function updateExpenseAnalysis() {
            const expenses = transactions.filter(t=>t.type==='expense');
            if(expenses.length===0){ expenseAnalysis.innerHTML='<p>Hakuna matumizi yaliyowekwa bado.</p>'; return; }
            const totalExpenses = expenses.reduce((sum, t)=>sum+t.amount, 0);
            const expensesByCategory = {};
            expenses.forEach(e=>{ const c=e.category||'Nyingine'; expensesByCategory[c]=(expensesByCategory[c]||0)+e.amount; });
            let html=`<p>Jumla ya matumizi: <strong>TSh ${formatCurrency(totalExpenses)}</strong></p><p>Matumizi kwa kila aina:</p><ul style="list-style:none; padding:0;">`;
            for(const c in expensesByCategory){
                const amt = expensesByCategory[c];
                const pct = ((amt/totalExpenses)*100).toFixed(1);
                html+=`<li style="margin-bottom:8px; padding:5px; background:#f8f9fa; border-radius:5px;"><strong>${c}</strong>: TSh ${formatCurrency(amt)} (${pct}%)</li>`;
            }
            html+='</ul>';
            expenseAnalysis.innerHTML = html;
        }

        incomeForm.addEventListener('submit', function(e){
            e.preventDefault();
            const amount=parseFloat(document.getElementById('income-amount').value);
            const source=document.getElementById('income-source').value;
            const date=document.getElementById('income-date').value;
            if(!amount || amount<=0){ showMessage("Tafadhali weka kiasi sahihi cha mapato.", "error"); return; }
            transactions.push({id:generateId(), type:'income', amount, description:source, date});
            saveTransactions(); updateUI(); updateExpenseAnalysis(); this.reset();
            document.getElementById('income-date').value = new Date().toISOString().split('T')[0];
            showMessage("Kiasi cha mapato kimeongezwa.", "success");
        });

        expenseForm.addEventListener('submit', function(e){
            e.preventDefault();
            const amount=parseFloat(document.getElementById('expense-amount').value);
            const category=document.getElementById('expense-category').value;
            const description=document.getElementById('expense-description').value;
            const date=document.getElementById('expense-date').value;
            if(!amount || amount<=0){ showMessage("Tafadhali weka kiasi sahihi cha matumizi.", "error"); return; }
            if(!category){ showMessage("Tafadhali chagua aina ya matumizi.", "error"); return; }
            transactions.push({id:generateId(), type:'expense', amount, category, description, date});
            saveTransactions(); updateUI(); updateExpenseAnalysis(); this.reset();
            document.getElementById('expense-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('expense-category').value = "";
            showMessage("Matumizi yamerekodiwa.", "success");
        });

        function deleteTransaction(id){
            transactions = transactions.filter(t=>t.id!==id);
            saveTransactions(); updateUI(); updateExpenseAnalysis();
            showMessage("Shughuli imeondolewa.", "success");
        }

        function saveTransactions(){ localStorage.setItem('transactions', JSON.stringify(transactions)); }
        function generateId(){ return Date.now().toString(36)+Math.random().toString(36).substr(2); }
        function formatCurrency(amount){ return parseFloat(amount).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g,","); }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
